@ECHO OFF
SETLOCAL DISABLEDELAYEDEXPANSION

SET FILE_PATH=%~1
SET SNOWSQL_DATABASE=%~2

break>"%FILE_PATH%"tbldata_copy.sql

FOR %%A IN ("%FILE_PATH%"*.txt) DO (
	SETLOCAL ENABLEDELAYEDEXPANSION
	SET TABLE_NAME=%%~nA
	SET STAGING_TABLE_NAME=!TABLE_NAME:.=.%%!
	
	echo COPY INTO !SNOWSQL_DATABASE!.!TABLE_NAME! FROM @!SNOWSQL_DATABASE!.!STAGING_TABLE_NAME! FILES = ^('!TABLE_NAME!.txt.gz'^) FILE_FORMAT = ^( FORMAT_NAME = ADM.MYZIPPEDTABFORMAT ^); >> "%FILE_PATH%"tbldata_copy.sql
	SETLOCAL DISABLEDELAYEDEXPANSION
)

SETLOCAL DISABLEDELAYEDEXPANSION